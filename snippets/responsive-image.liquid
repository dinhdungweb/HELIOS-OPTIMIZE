{%- liquid
  if aspect_ratio
    assign cover = true
  else
    assign aspect_ratio = image.aspect_ratio
    assign cover = false
  endif
  assign aspect_ratio = aspect_ratio | at_least: min_aspect_ratio
-%}

<div class="rimage-outer-wrapper" style="max-width: {{ image.width }}px"
  {% if animateZoom %}data-cc-animate="cc-zoom-out"{% endif %}
>
  <div class="rimage-wrapper lazyload--placeholder" style="padding-top:{{ 1 | divided_by: aspect_ratio | times: 100 }}%">
    {% if initial %}
      <!-- Optimized: Use native lazy loading -->
      <img class="rimage__image fade-in {% if cover %}cover{% endif %}" 
        src="{{ image | image_url: width: 200 }}" 
        alt="{{ image.alt | escape }}"
        loading="eager"
        width="{{ image.width }}"
        height="{{ image.height }}">
      {% assign initial = false %}
    {% endif %}
    
    <!-- Optimized: Native lazy loading with responsive srcset -->
    <img class="rimage__image fade-in {% if cover %}cover{% endif %}"
      src="{{ image | image_url: width: 800 }}"
      srcset="{{ image | image_url: width: 480 }} 480w,
              {{ image | image_url: width: 720 }} 720w,
              {{ image | image_url: width: 1024 }} 1024w,
              {{ image | image_url: width: 1280 }} 1280w,
              {{ image | image_url: width: 1600 }} 1600w"
      sizes="(max-width: 480px) 100vw,
             (max-width: 768px) 90vw,
             (max-width: 1024px) 80vw,
             70vw"
      alt="{{ image.alt | escape }}"
      loading="lazy"
      decoding="async"
      width="{{ image.width }}"
      height="{{ image.height }}"
      {% if cover %}class="cover"{% endif %}
      {% if image.presentation %}style="object-position: {{ image.presentation.focal_point }}"{% endif %}>

    <noscript>
      <img src="{{ image | image_url: width: 1024 }}" 
           alt="{{ image.alt | escape }}" 
           class="rimage__image"
           width="{{ image.width }}"
           height="{{ image.height }}">
    </noscript>
  </div>
</div>
